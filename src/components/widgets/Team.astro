---
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import Image from '~/components/common/Image.astro';
import type { Team as Props } from '~/types';
import { twMerge } from 'tailwind-merge';

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),
  team = [],
  columns = 3,

  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;

const classesTyped = classes as Record<string, string | Record<string, string>>;
const {
  container: containerClass = '',
  panel: panelClass = '',
  image: imageClass = '',
  name: nameClass = '',
  description: descriptionClass = '',
} = (classesTyped?.items as Record<string, string>) || {};
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-7xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <Headline
    title={title}
    subtitle={subtitle}
    tagline={tagline}
    classes={{
      title: 'text-4xl md:text-5xl font-bold tracking-tight mb-4 font-heading',
      ...((classesTyped?.headline as Record<string, string>) ?? {}),
    }}
  />
  {
    team && team.length > 0 && (
      <div
        class={twMerge(
          `grid gap-8 gap-x-12 sm:gap-y-8 ${
            columns === 4
              ? 'lg:grid-cols-4 md:grid-cols-3 sm:grid-cols-2'
              : columns === 3
                ? 'lg:grid-cols-3 sm:grid-cols-2'
                : columns === 2
                  ? 'sm:grid-cols-2'
                  : 'sm:grid-cols-1'
          }`,
          containerClass ||
            'max-w-6xl mx-auto px-4 pt-4 pb-[2.8rem] sm:px-8 sm:pt-6 sm:pb-[4.2rem] lg:px-12 lg:pt-8 lg:pb-[5.6rem]'
        )}
      >
        {team.map((member) => (
          <div
            class={twMerge(
              'relative flex flex-col items-center text-center intersect-once intersect-quarter intersect-no-queue motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade',
              panelClass ||
                'w-full rounded-[16px] border border-border bg-white dark:shadow-[0_4px_30px_rgba(0,0,0,0.1)] backdrop-blur dark:bg-slate-900 p-6',
              (member.classes as Record<string, string>)?.panel || ''
            )}
          >
            {member.image && (
              <div
                class={twMerge(
                  'mb-4 w-32 h-32 overflow-hidden rounded-full',
                  imageClass,
                  (member.classes as Record<string, string>)?.image || ''
                )}
              >
                <Image
                  src={member.image.src}
                  alt={member.image.alt || member.name || 'Team member'}
                  width={128}
                  height={128}
                  class="w-full h-full object-cover"
                />
              </div>
            )}
            {member.name && (
              <h3
                class={twMerge(
                  'text-2xl md:text-3xl font-bold mb-2',
                  nameClass,
                  (member.classes as Record<string, string>)?.name || ''
                )}
              >
                {member.name}
              </h3>
            )}
            {member.job && (
              <p
                class={twMerge(
                  'text-base md:text-lg text-muted mb-3 font-bold',
                  (member.classes as Record<string, string>)?.job || ''
                )}
              >
                {member.job}
              </p>
            )}
            {member.description && (
              <p
                class={twMerge(
                  'text-muted text-base md:text-lg leading-relaxed',
                  descriptionClass,
                  (member.classes as Record<string, string>)?.description || ''
                )}
              >
                {member.description}
              </p>
            )}
          </div>
        ))}
      </div>
    )
  }
</WidgetWrapper>
